{{ define "content" }}

<!-- What is this author's name ? -->
{{- $thisauthor := .Params.author -}}

<!-- Get the details from the authors csv -->
{{- $url := "/csv/authors.csv" -}}
{{- $sep := "," -}}
{{- range $i, $r := getCSV $sep $url -}}
    {{- $author := index $r 8 -}}
    {{- if eq $author $thisauthor -}}
        {{- $.Scratch.Set "profession" (index $r 9) -}}
        {{- $.Scratch.Set "nationality" (index $r 10) -}}
        {{- $.Scratch.Set "dob" (index $r 11) -}}
        {{- $.Scratch.Set "dod" (index $r 12) -}}
        {{- $.Scratch.Set "briefbio" (index $r 13) -}}
        {{- $.Scratch.Set "fullbio" (index $r 17) -}}
    {{- end -}}
{{- end -}}

{{- if isset .Params "background" -}}
<!-- <img src="{{ .Params.background }}" style="position: fixed; right: 0; top: 0; width: 100%; height: auto; z-index: -1; opacity: 0.6;" /> -->
{{- end -}}

<div class="section bb no-pad-top">
    <div class="container">
        <div class="row">
            <div class="col s12 m9 l9">
                <h2 class="c-quotes-200 linetoend">{{ .Title }}</h2>
                <div class="grid">

                    <div class="gutter-sizer"></div>
                    <div class="grid-sizer"></div>

                    <!-- <div class="gi s12 m12 l4">
                        <div class="card fluid center">
                            <h2 class="c-quotes-gradient">
                                {{- .Params.Author -}}
                            </h2>
                        </div>
                    </div> -->

                    <!-- <div class="grid-item">
                        <div class="card">
                            <h3>BIO</h3>
                            <p>{{- $.Scratch.Get "briefbio" -}}</p>
                        </div>
                    </div> -->

                    {{ $.Scratch.Set "image" .Params.image }}
                    {{- $url := "/csv/quotes.csv" -}}
                    {{- $sep := "," -}}
                    {{- $.Scratch.Delete "quoteid" -}}
                    {{- $.Scratch.Set "quoteid" 1 -}}
                    {{- range $i, $r := getCSV $sep $url -}}
                    {{- $author := index $r 3 -}}
                    {{- $tags := index $r 9 -}}
                    {{- if eq $author $thisauthor -}}
                    {{- $quote := index $r 8 -}}
                    {{- if lt ($quote | countwords) 10 -}}
                    <div class="gi s12 m6 l4">
                    {{- else if lt ($quote | countwords) 20 -}}
                    <div class="gi s12 m6 l4">
                    {{- else -}}
                    <div class="gi s12 m6 l4">
                    {{- end -}}
                    {{- if eq (mod ($.Scratch.Get "quoteid") 3) 0 -}}
                        {{- if lt ($quote | countwords) 10 -}}
                        <div class="card quote font-8 bg-quotes-gradient z-depth-3">
                        {{- else if lt ($quote | countwords) 20 -}}
                        <div class="card quote font-6 bg-quotes-gradient z-depth-3">
                        {{- else -}}
                        <div class="card quote font-4 bg-quotes-gradient z-depth-3">
                        {{- end -}}                    
                            <figure>
                                <blockquote>{{ $quote }}</blockquote>
                                <figcaption>{{ $author }}</figcaption>
                            </figure>
                        </div>
                    {{- else -}}
                        <div class="card fluid font-4" data-k-tagcsv="{{ $tags }}" data-k-quoteid="{{ $.Scratch.Get "quoteid" }}">
                            <div class="img-container bb-quotes" id="img_container_{{ $.Scratch.Get "qteid" }}">
                                <img src="https://source.unsplash.com/600x200/?{{ $tags }}" />
                            </div>
                            <div class="content no-pad-top bg-quotes-gradient center" id="content_{{ $.Scratch.Get "quoteid" }}">
                                <br>
                                <h4 class="title">"{{ $quote }}"</h4>
                                <h5>{{ $author }}</h5>
                            </div>
                        </div>
                    {{- end -}}

                        <!-- <div class="card quote bg-dark-to-right" >
                            <figure class="z-depth-5">
                                <img src="{{ $.Scratch.Get "image" }}" />
                                <blockquote>{{ $quote | humanize }}</blockquote>
                                <figcaption>{{ $author }}</figcaption>
                            </figure>
                        </div> -->
                        <!-- <blockquote class="z-depth-{{ index (seq 5 | shuffle) 0 }}"> -->
                    </div>
                    {{- end -}}
                    {{- $.Scratch.Set "quoteid" (add ($.Scratch.Get "quoteid") 1) -}}
                    {{- end -}}

                </div>
                
            </div>

            <div class="col s12 m3 l3">
                
                <div class="card fluid">
                    <h2 class="c-quotes-200 linetoend">Profile</h2>
                    <div class="c-gradient">
                        <h4>{{ $thisauthor }}</h4>
                        <!-- <h3 class="quotes-gradient-text">Nationality</h3> -->
                        <h4>{{ $.Scratch.Get "nationality" }}</h4>
                        <!-- <h3 class="quotes-gradient-text">Profession</h3> -->
                        <h4>{{ $.Scratch.Get "profession" }}</h4>
                        <!-- <h3 class="quotes-gradient-text">Date of Birth</h3> -->
                        <h4>Born {{ $.Scratch.Get "dob" }}</h4>
                        <!-- <h3 class="quotes-gradient-text">Full Bio</h3> -->
                        <h4><a class="c-gradient display-inline-block" target="_blank" href="{{ $.Scratch.Get "fullbio" }}">Full Bio (Wikipedia) ></a></h4>
                    </div>
                </div>
                
                <h2 class="c-quotes-200 linetoend">More Authors</h2>
                {{- $.Scratch.Set "g-card-counter" 0 -}}
                {{- range where .Site.Pages "Section" "quotes" | first 20 -}}
                {{- if .IsDescendant ($.Site.GetPage "/quotes/authors") -}}
                {{- if and (ne .Title "Quotes By Author") (ne .Params.author $thisauthor) -}}
                {{- if lt ($.Scratch.Get "g-card-counter") 4 -}}
                <div class="card font-3 wide h2 bg-quotes-400 z-depth-5">
                    {{- partial "card-author.html" . -}}
                </div>
                {{- $.Scratch.Set "g-card-counter" (add ($.Scratch.Get "g-card-counter") 1) -}}
                {{- end -}}
                {{- end -}}
                {{- end -}}
                {{- end -}}

                <div class="row"></div>
                <h2 class="c-quotes-100 linetoend">Topics</h2>
                {{- $.Scratch.Set "g-card-counter" 0 -}}
                {{- range where .Site.Pages "Section" "quotes" | first 20 -}}
                {{- if .IsDescendant ($.Site.GetPage "/quotes/topics") -}}
                {{- if and (ne .Title "Quotes By Topic") (ne .Title ($.Scratch.Get "thistitle")) -}}
                {{- if lt ($.Scratch.Get "g-card-counter") 5 -}}
                <div class="card font-3 wide h2 bg-quotes-400 z-depth-5 font-medium">
                    {{- partial "card-topic.html" . -}}
                </div>
                {{- $.Scratch.Set "g-card-counter" (add ($.Scratch.Get "g-card-counter") 1) -}}
                {{- end -}}
                {{- end -}}
                {{- end -}}
                {{- end -}}
                
            </div>

        </div>
    </div>
</div>

{{ end }}